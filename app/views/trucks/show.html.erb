<br>

<div class="panel panel-default">
   <div style="text-align:center;" class="panel-heading">ทะเบียนรถ: <%= @truck.plate %></div>
<div style="background-color:transparent !important;" class="jumbotron" >

<br>
<div class="progress">
  <div id ="engine-oil" class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="100" aria-valuemax="100" style="">
  </div>
</div>


<div class="progress">
  <div id="transmission-oil" class="progress-bar" role="progressbar" aria-valuenow="15" aria-valuemin="100" aria-valuemax="90" style="">
  </div>
</div>

<div class="progress">
  <div id="gear-oil" class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="100" aria-valuemax="90" style="">
  </div>
</div>

<div class="progress">
  <div id="air-filter" class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="10จ" aria-valuemin="0" aria-valuemax="90" style="">
  </div>
</div>

<div class="progress">
  <div id="water-coolant" class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="100" aria-valuemax="90" style="">

  </div>
</div>

<div class="progress">
  <div id="cement-blower" class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="100" aria-valuemax="90" style="">
  </div>
</div>


<!-- Trigger the modal with a button -->
<% if current_user.role?("admin") %>
  <br><br>
  <button id="button-width" type="button" class="btn btn-primary btn-block" data-toggle="modal" data-target="#myModal"><span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>&nbsp; รีเซ็ต</button>
<% end %>

<div id="myModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
  <div class="modal-dialog modal-sm" style="width: 33%;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">รีเซ็ตระยะทาง <%= @truck.plate %></h4>
      </div>
      <table class="table table-striped">
        <tr>
          <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <%= number_with_delimiter(@truck.total_engine_distance, :delimiter => ',') %> / <%= number_with_delimiter(@maintenance_red.engine_alert.to_i, :delimiter => ',') %> กิโลเมตร </td>
          <td align="center"> <%= button_to 'น้ำมันเครื่อง', truck_reEngine_path(id: @truck.id), method: :post, data: { confirm: 'Are you sure?' },id: "reset-button"%> </td>
        </tr>

        <tr>
          <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <%= number_with_delimiter(@truck.total_transmission_distance, :delimiter => ',') %> / <%= number_with_delimiter(@maintenance_red.transmission_alert.to_i, :delimiter => ',') %> กิโลเมตร </td>
          <td align="center"> <%= button_to 'น้ำมันเกียร์', truck_reTransmission_path(id: @truck.id), method: :post, data: { confirm: 'Are you sure?' },id: "reset-button" %> </td>
        </tr>

        <tr>
          <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <%= number_with_delimiter(@truck.total_gear_distance, :delimiter => ',') %> / <%= number_with_delimiter(@maintenance_red.gear_alert.to_i, :delimiter => ',') %> กิโลเมตร </td>
          <td align="center"> <%= button_to 'น้ำมันแฟืองท้าย', truck_reGear_path(id: @truck.id), method: :post, data: { confirm: 'Are you sure?' },id: "reset-button" %> </td>
        </tr>

        <tr>
          <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <%= number_with_delimiter(@truck.total_air_distance, :delimiter => ',') %> / <%= number_with_delimiter(@maintenance_red.air_alert.to_i, :delimiter => ',') %> กิโลเมตร </td>
          <td align="center"> <%= button_to 'กรองอากาศ', truck_reAir_path(id: @truck.id), method: :post, data: { confirm: 'Are you sure?' },id: "reset-button" %> </td>
        </tr>

        <tr>
          <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <%= number_with_delimiter(@truck.total_coolant_distance, :delimiter => ',') %> / <%= number_with_delimiter(@maintenance_red.coolant_alert.to_i, :delimiter => ',') %> กิโลเมตร </td>
          <td align="center"> <%= button_to 'น้ำยาหม้อน้ำ', truck_reCoolant_path(id: @truck.id), method: :post, data: { confirm: 'Are you sure?' },id: "reset-button" %> </td>
        </tr>

        <tr>
          <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <%= number_with_delimiter(@truck.total_blower_distance, :delimiter => ',') %> / <%= number_with_delimiter(@maintenance_red.blower_alert.to_i, :delimiter => ',') %> กิโลเมตร </td>
          <td align="center"> <%= button_to 'น้ำยาปั้มลม', truck_reBlower_path(id: @truck.id), method: :post, data: { confirm: 'Are you sure?' },id: "reset-button" %> </td>
        </tr>
      </table>
      <!-- <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">ปิด</button>
      </div> -->
    </div>
  </div>
</div>
</div>
</div>

<br>
<table id="text-center" class="table table-striped">
  <thead>
    <tr id="bold">
      <td align="center">วันที่ ป/ด/ว</td>
      <td align="center">พนักงานขับรถ</td>
      <td align="center">จำนวนตัน</td>
      <td align="center">น้ำมัน(ลิตร)</td>
      <td align="center">ระยะทาง</td>
      <td align="center">เรทน้ำมัน</td>
      <td align="center">ชนิดปูน</td>
      <td align="center">สถานที่ส่งของ</td>
    </tr>
  </thead>

<% @trips.each do |trip| %>
  <tr>
    <td align="center"><%= trip.trip_date %></td>
    <td align="center"><%= trip.driver %></td>
    <td align="center"><%= trip.weight %></td>
    <td align="center"><%= trip.liter %></td>
    <td align="center"><%= trip.distance %></td>
    <td align="center"><%= trip.average %></td>
    <td align="center"><%= trip.cement %></td>
    <td align="center"><%= trip.destination %></td>
    <% if current_user.role?("admin") %>
      <td class="table-bordered" align="center"><%= link_to 'แก้ไข', edit_truck_trip_path(@truck, trip) %> </td>
    <% end %>
  </tr>
<% end %>
</table>

<br>


<script>
  // -----------engine oil bar------------
  var engine_oil_bar = ( <%= @truck.total_engine_distance %>/<%= @maintenance_red.engine_alert.to_i %> ) * 100

  document.getElementById("engine-oil").innerHTML = "น้ำมันเครื่อง " + engine_oil_bar.toFixed(1) + "%" + "  (" + (<%= @truck.total_engine_distance %>).toLocaleString() + "/" + (<%= @maintenance_red.engine_alert.to_i %>).toLocaleString() + " กิโลเมตร" + ")";

  if ( <%= @truck.total_engine_distance %> < <%= @maintenance_orange.engine_alert.to_i %> ){
    document.getElementById("engine-oil").className = "progress-bar progress-bar-success";
  }
  else if (( <%= @truck.total_engine_distance %> < <%= @maintenance_red.engine_alert.to_i %> )) {
    document.getElementById("engine-oil").className = "progress-bar progress-bar-warning";
  }
  else {
    document.getElementById("engine-oil").className = "progress-bar progress-bar-danger";
  }
  // another loop
  if (engine_oil_bar > 100) {
    engine_oil_bar = 100
    document.getElementById("engine-oil").style.width = engine_oil_bar + "%";
  }
  else {
    document.getElementById("engine-oil").style.width = engine_oil_bar + "%";
  }

  // -----------transmission oil bar------------
  var transmission_oil_bar = ( <%= @truck.total_transmission_distance %>/<%= @maintenance_red.transmission_alert.to_i %> ) * 100

  document.getElementById("transmission-oil").innerHTML = "น้ำมันเกียร์ " + transmission_oil_bar.toFixed(1) + "%" + "  (" + (<%= @truck.total_transmission_distance %>).toLocaleString() + "/" + (<%= @maintenance_red.transmission_alert.to_i %>).toLocaleString() + " กิโลเมตร" + ")";

  if ( <%= @truck.total_transmission_distance %> < <%= @maintenance_orange.transmission_alert.to_i %> ){
    document.getElementById("transmission-oil").className = "progress-bar progress-bar-success";
  }
  else if (( <%= @truck.total_transmission_distance %> < <%= @maintenance_red.transmission_alert.to_i %> )) {
    document.getElementById("transmission-oil").className = "progress-bar progress-bar-warning";
  }
  else {
    document.getElementById("transmission-oil").className = "progress-bar progress-bar-danger";
  }
  // another loop
  if (transmission_oil_bar > 100) {
    transmission_oil_bar = 100
    document.getElementById("transmission-oil").style.width = transmission_oil_bar + "%";
  }
  else {
    document.getElementById("transmission-oil").style.width = transmission_oil_bar + "%";
  }

  // -----------gear oil bar------------
  var gear_oil_bar = ( <%= @truck.total_gear_distance %>/<%= @maintenance_red.gear_alert.to_i %> ) * 100

  document.getElementById("gear-oil").innerHTML = "น้ำมันเฟืองท้าย " + gear_oil_bar.toFixed(1) + "%" + "  (" + (<%= @truck.total_gear_distance %>).toLocaleString() + "/" + (<%= @maintenance_red.gear_alert.to_i %>).toLocaleString() + " กิโลเมตร" + ")";

  if ( <%= @truck.total_gear_distance %> < <%= @maintenance_orange.gear_alert.to_i %> ){
    document.getElementById("gear-oil").className = "progress-bar progress-bar-success";
  }
  else if (( <%= @truck.total_gear_distance %> < <%= @maintenance_red.gear_alert.to_i %> )) {
    document.getElementById("gear-oil").className = "progress-bar progress-bar-warning";
  }
  else {
    document.getElementById("gear-oil").className = "progress-bar progress-bar-danger";
  }
  // another loop
  if (gear_oil_bar > 100) {
    gear_oil_bar = 100
    document.getElementById("gear-oil").style.width = gear_oil_bar + "%";
  }
  else {
    document.getElementById("gear-oil").style.width = gear_oil_bar + "%";
  }

  // -----------air filter bar------------
  var air_filter_bar = ( <%= @truck.total_air_distance %>/<%= @maintenance_red.air_alert.to_i %> ) * 100

  document.getElementById("air-filter").innerHTML = "กรองอากาศ " + air_filter_bar.toFixed(1) + "%" + "  (" + (<%= @truck.total_air_distance %>).toLocaleString() + "/" + (<%= @maintenance_red.air_alert.to_i %>).toLocaleString() + " กิโลเมตร" + ")";

  if ( <%= @truck.total_air_distance %> < <%= @maintenance_orange.air_alert.to_i %> ){
    document.getElementById("air-filter").className = "progress-bar progress-bar-success";
  }
  else if (( <%= @truck.total_air_distance %> < <%= @maintenance_red.air_alert.to_i %> )) {
    document.getElementById("air-filter").className = "progress-bar progress-bar-warning";
  }
  else {
    document.getElementById("air-filter").className = "progress-bar progress-bar-danger";
  }
  // another loop
  if (air_filter_bar > 100) {
    air_filter_bar = 100
    document.getElementById("air-filter").style.width = air_filter_bar + "%";
  }
  else {
    document.getElementById("air-filter").style.width = air_filter_bar + "%";
  }

  // -----------water coolant bar------------
  var water_coolant_bar = ( <%= @truck.total_coolant_distance %>/<%= @maintenance_red.coolant_alert.to_i %> ) * 100

  document.getElementById("water-coolant").innerHTML = "น้ำยาหม้อน้ำ " + water_coolant_bar.toFixed(1) + "%" + "  (" + (<%= @truck.total_coolant_distance %>).toLocaleString() + "/" + (<%= @maintenance_red.coolant_alert.to_i %>).toLocaleString() + " กิโลเมตร" + ")";

  if ( <%= @truck.total_coolant_distance %> < <%= @maintenance_orange.coolant_alert.to_i %> ){
    document.getElementById("water-coolant").className = "progress-bar progress-bar-success";
  }
  else if (( <%= @truck.total_coolant_distance %> < <%= @maintenance_red.coolant_alert.to_i %> )) {
    document.getElementById("water-coolant").className = "progress-bar progress-bar-warning";
  }
  else {
    document.getElementById("water-coolant").className = "progress-bar progress-bar-danger";
  }
  // another loop
  if (water_coolant_bar > 100) {
    water_coolant_bar = 100
    document.getElementById("water-coolant").style.width = water_coolant_bar + "%";
  }
  else {
    document.getElementById("water-coolant").style.width = water_coolant_bar + "%";
  }

  // -----------cement blower bar------------
  var cement_blower_bar = ( <%= @truck.total_blower_distance %>/<%= @maintenance_red.blower_alert.to_i %> ) * 100
  var count = 0;
  document.getElementById("cement-blower").innerHTML = "น้ำยาปั้มลม " + cement_blower_bar.toFixed(1) + "%" + "  (" + (<%= @truck.total_blower_distance %>).toLocaleString() + "/" + (<%= @maintenance_red.blower_alert.to_i %>).toLocaleString() + " กิโลเมตร" + ")";

  if ('<%= @truck.bulker %>' == 'false') {
    document.getElementById("cement-blower").className = "progress-bar progress-bar-info";
    document.getElementById("cement-blower").innerHTML = "คันนี้ไม่มีเครื่องปั้มลม";
    var count = 1;
  }


  else if ( <%= @truck.total_blower_distance %> < <%= @maintenance_orange.blower_alert.to_i %> ){
    document.getElementById("cement-blower").className = "progress-bar progress-bar-success";
  }
  else if (( <%= @truck.total_blower_distance %> < <%= @maintenance_red.blower_alert.to_i %> )) {
    document.getElementById("cement-blower").className = "progress-bar progress-bar-warning";
  }
  else {
    document.getElementById("cement-blower").className = "progress-bar progress-bar-danger";
  }
  // another loop
  if (cement_blower_bar > 100) {
    cement_blower_bar = 100
    document.getElementById("cement-blower").style.width = cement_blower_bar + "%";
  }
  else if (count == 0) {
    document.getElementById("cement-blower").style.width = cement_blower_bar + "%";
  }
  else {
    document.getElementById("cement-blower").style.width = "100%";
  }

</script>
